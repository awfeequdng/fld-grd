(function(t,e){if(typeof define==="function"&&define.amd){define("FldGrd",["module","exports"],e)}else if(typeof exports!=="undefined"){e(module,exports)}else{var i={exports:{}};e(i,i.exports);t.FldGrd=i.exports}})(this,function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:true});var i={rowHeight:250,rowHeightOrphan:function h(t){return Math.round(t.heightAvg)},itemSelector:"*",objSelector:"img",dataWidth:"data-fld-width",dataHeight:"data-fld-height"};function s(t,e){var i=[];var s=null;var n=null;var r=null;s=e.split(",");if(!t.id){r="_temp_"+Math.random().toString(36).substr(2,10);t.setAttribute("id",r)}while(s.length){i.push("#"+t.id+" > "+s.pop())}n=document.querySelectorAll(i.join(", "));if(r){t.removeAttribute("id")}return n}function n(t){for(var e=arguments.length,i=Array(e>1?e-1:0),s=1;s<e;s++){i[s-1]=arguments[s]}var n=Object(t);Object.keys(i).forEach(function(t){if(i[t]!==undefined&&i[t]!==null){Object.keys(i[t]).forEach(function(e){n[e]=i[t][e]})}});return n}var r=function a(t,e){if(!(t instanceof Element)){throw new Error("`el` is not an element")}this.el=t;this.items=[];this._props={gutter:null,pendingResize:false};this._bind={};this._settings=n({},i,e);this._init();return this};r.prototype={_init:function o(){this._setup();this._attachEventListeners();this.update()},_setup:function l(){var t=null;var e=null;var i=null;var n=null;var r=null;var h=0;t=s(this.el,this._settings.itemSelector);n=t.length;r=getComputedStyle(t[0],null);this._props.gutter+=parseInt(r.marginLeft,10)||0;this._props.gutter+=parseInt(r.marginRight,10)||0;this._props.gutter+=parseInt(r.paddingLeft,10)||0;this._props.gutter+=parseInt(r.paddingRight,10)||0;for(;h<n;h++){e=parseInt(t[h].getAttribute(this._settings.dataWidth),10);i=parseInt(t[h].getAttribute(this._settings.dataHeight),10);if(isNaN(e)||isNaN(i)){continue}this.items.push({width:e,normWidth:e*(this._settings.rowHeight/i),height:i,el:t[h].querySelector(this._settings.objSelector)})}},update:function d(){var t=this.el.clientWidth;var e=this.items.length;var i=[];var s=0;var n=0;var r=0;var h=0;var a=0;var o=0;var l=0;var d=0;var u=false;var p=0;var g=0;for(;p<e;p++){n+=this.items[p].normWidth;h+=this._props.gutter;u=p===e-1;if(n+h>=t||u){r=t-h;if(r/n>1&&u){a=this._settings.rowHeightOrphan.call(this,{heightAvg:o/i.length,heights:i});l=a/this._settings.rowHeight}else{l=Math.min(r/n,1);a=Math.floor(l*this._settings.rowHeight)}i.push(a);o+=a;for(g=s;g<=p;g++){d=Math.floor(l*this.items[g].normWidth)-1;this.items[g].el.style.width=d+"px";this.items[g].el.style.height=a+"px"}n=0;h=0;s=p+1}}this._props.pendingResize=false;return this},_attachEventListeners:function u(){this._bind.resize=this._handleResize.bind(this);window.addEventListener("resize",this._bind.resize)},_handleResize:function p(){if(!this._props.pendingResize){this._props.pendingResize=true;window.requestAnimationFrame(this.update.bind(this))}},destroy:function g(){window.removeEventListener("resize",this._bind.resize);this.el=this.items=this._bind=this._settings=this._handlers=null}};e.default=r;t.exports=e["default"]});